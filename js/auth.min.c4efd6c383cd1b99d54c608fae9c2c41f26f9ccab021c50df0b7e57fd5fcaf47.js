(()=>{async function e(e,{persist:t=!0}={}){try{const a=await fetch("https://8gatyboaf6.execute-api.af-south-1.amazonaws.com/default/verifyUser",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({token:e})}),n=await a.json();console.log("Lambda response:",n);const s=document.getElementById("user-info"),o=document.getElementById("login-btn"),i=document.getElementById("logout-btn");return n.authorized?(s.textContent=`‚úÖ Login successful! Welcome, ${n.email}`,o.style.display="none",i.style.display="inline-block",console.log("ChessaID: "+n.chessaId),t&&localStorage.setItem("authUser",JSON.stringify({fideId:n.fideId,chessaId:n.chessaId,token:e,email:n.email,authorized:!0})),setTimeout(()=>{window.location.href="/stats/"},3e3)):(s.textContent=`‚ùå Access denied for ${n.email||"unknown user"}`,o.style.display="inline-block",i.style.display="none",localStorage.removeItem("authUser"),console.warn("Unauthorized user:",n.email,n.error||"")),n}catch(e){return console.error("Error verifying user:",e),document.getElementById("user-info").textContent="‚ö†Ô∏è Error verifying login.",{authorized:!1}}}function n(t){const n=t.credential;console.log("Google ID token received:",n),e(n,{persist:!0})}function t(){console.log("User logged out");const e=document.getElementById("user-info"),t=document.getElementById("login-btn"),n=document.getElementById("logout-btn");e.textContent="üëã You have logged out.",t.style.display="inline-block",n.style.display="none",localStorage.removeItem("authUser")}async function s(){const t=localStorage.getItem("authUser");if(!t)return;try{const n=JSON.parse(t);console.log("Restoring session, verifying with Lambda‚Ä¶",n);const s=await e(n.token,{persist:!1});s.authorized||(console.log("Stored token invalid/expired, clearing session."),localStorage.removeItem("authUser"),document.getElementById("user-info").textContent="‚ö†Ô∏è Session expired, please log in again.",document.getElementById("login-btn").style.display="inline-block",document.getElementById("logout-btn").style.display="none")}catch(e){console.error("Failed to restore session:",e),localStorage.removeItem("authUser")}}window.onGoogleSignIn=n,window.logout=t,document.getElementById("logout-btn").addEventListener("click",t),s()})()